{% load static %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>StrangeFlix</title>
    <!-- font-awesome  -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" href="{% static "css/fontawesome.min.css" %}"> -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <!-- google-fonts -->
    <link href="https://fonts.googleapis.com/css?family=Cinzel+Decorative:900|IBM+Plex+Sans&display=swap"
        rel="stylesheet">

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- css  -->
    <link rel="stylesheet" href="{% static "css/homes.css" %}">
</head>

<body onbeforeunload="save_history_before_unloading()">
    <div class="navbar-section">
        <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
            <a href="#" class="navbar-brand py-3 font-weight-bold">Strangeflix</a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav">
                    <li class="nav-item active"><a class="nav-link" href="{% url 'home_page' %}">Home</a></li>
                    <li class="nav-item">
                        <!-- <a class="nav-link" href="#"> -->
                        <div class="dropdown py-2 px-2 specia-drop">
                            <button class="rem-button" id="dropdownMenu2" aria-haspopup="true" aria-expanded="false">
                                Sports
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                <div class="dropdown-item">
                                    <a href="" onclick="search_results_by_subcategory('Cricket')">Cricket</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Football')">Football</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Tennis')">Tennis</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Martial Arts')">Martial Arts</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Esports')">eSports</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Hockey')">Hockey</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Badminton')">Badminton</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Wrestling')">Wrestling</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Kabaddi')">Kabbadi</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Table Tennis')">Table Tennis</a>
                                </div>
                            </div>
                        </div>
                        <!-- </a> -->
                    </li>
                    <li class="nav-item">
                        <div class="dropdown py-2 px-2 specia-drop">
                            <button class="rem-button" id="dropdownMenu3" aria-haspopup="true" aria-expanded="false">
                                Entertainment
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenu3">
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Action')">Action</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Adventure')">Adventure</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Animation')">Animation</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Comedy')">Comedy</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Crime')">Crime</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Drama')">Drama</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Horror')">Horror</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Romance')">Romance</a>
                                </div>
                                <div class="dropdown-item">
                                    <a href="#" onclick="search_results_by_subcategory('Thriller')">Thriller</a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="navbar-nav ml-auto">

                    <!-- search bar  -->
                    <div class="dropdown px-1 specia-drop">
                        <input onkeyup="get_search_results()" type="text" id="sear" class="form-control mr-sm-2" placeholder="search by name">
                        <div id="search-results">
                        </div>

                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-dark">Search</button>
                        <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split"
                            aria-haspopup="true" aria-expanded="false">
                        </button>
                        <div class="dropdown-menu">
                            <button id="sear-by-nam" class="dropdown-item btn-secondary">Search by name</a>
                                <button id="sear-by-tag" class="dropdown-item btn-secondary">Search by tags</a>
                        </div>
                    </div>

                    {% if user.is_authenticated %}
                    <li class="mx-4">
                        <div class="btn-group specia-drop">
                            <button class="rem-button py-2 px-2" aria-haspopup="true" aria-expanded="false">
                                {{ user.username }}
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" href="#">Profile</a>
                                <a class="dropdown-item" href="{% url "subscription_plans" %}">Subscribe</a>
                                <a class="dropdown-item" href="{% url "wallet_details" %}">Wallet</a>
                                <a class="dropdown-item" href="{% url "index" %}">My Rooms</a>
                                <a class="dropdown-item" href="#">My favourites</a>
                                <a class="dropdown-item" href="{% url "account_logout" %}">Logout</a>
                            </div>
                        </div>
                    </li>
                    {% else %}
                    <li class="mx-4">
                        <!-- login  -->
                        <a href="#" class="nav-item nav-link ml-2" data-toggle="modal"
                            data-target="#loginModal">Login</a>
                    </li>
                    {% endif %}
                </div>
            </div>
        </nav>
        <!-- login modal  -->
        <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true" style="color: black;">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content bg-dark">
                    <div class="modal-header border-bottom-0">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-title text-center">
                            <h4 class="font-weight-bold my-3">Login</h4>
                        </div>
                        <div class="text-center mt-4">
                            <!-- <a href="{% url 'social:begin' 'facebook' %}" class="btn btn-block btn-social btn-facebook"
                                style="text-align:center;color: white;background: #3b5998;">
                                <svg aria-hidden="true" class="svg-icon iconFacebook" width="20" height="20"
                                    viewBox="0 0 18 18">
                                    <path
                                        d="M3 1a2 2 0 00-2 2v12c0 1.1.9 2 2 2h12a2 2 0 002-2V3a2 2 0 00-2-2H3zm6.55 16v-6.2H7.46V8.4h2.09V6.61c0-2.07 1.26-3.2 3.1-3.2.88 0 1.64.07 1.87.1v2.16h-1.29c-1 0-1.19.48-1.19 1.18V8.4h2.39l-.31 2.42h-2.08V17h-2.5z"
                                        fill="#ffffff"></path>
                                </svg>
                                Sign in with Facebook
                            </a>
                            <a href="{% url 'social:begin' 'google-oauth2' %}"
                                class="btn btn-block btn-social btn-facebook"
                                style="background-color:#ebecf5;text-align:center">
                                <svg aria-hidden="true" class="native svg-icon iconGoogle" width="20" height="20"
                                    viewBox="0 0 18 18">
                                    <path
                                        d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 002.38-5.88c0-.57-.05-.66-.15-1.18z"
                                        fill="#4285F4"></path>
                                    <path
                                        d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 01-7.18-2.54H1.83v2.07A8 8 0 008.98 17z"
                                        fill="#34A853"></path>
                                    <path d="M4.5 10.52a4.8 4.8 0 010-3.04V5.41H1.83a8 8 0 000 7.18l2.67-2.07z"
                                        fill="#FBBC05"></path>
                                    <path
                                        d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 001.83 5.4L4.5 7.49a4.77 4.77 0 014.48-3.3z"
                                        fill="#EA4335"></path>
                                </svg>

                                Sign in with Google
                            </a> -->
                            <a href="{% url 'social:begin' 'google-oauth2' %}"
                                class="btn btn-md btn-social btn-facebook bg-danger mx-1"
                                style="background-color:#ebecf5;text-align:center;border-radius:50%;">
                                <!-- <span class="fa fa-facebook"></span> -->
                                <svg aria-hidden="true" class="native svg-icon iconGoogle" width="20" height="20" style="font-size:1.2rem;position:relative;top:2px;"
                                    viewBox="0 0 18 18">
                                    <path
                                        d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 002.38-5.88c0-.57-.05-.66-.15-1.18z"
                                        fill="#4285F4"></path>
                                    <path
                                        d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 01-7.18-2.54H1.83v2.07A8 8 0 008.98 17z"
                                        fill="#34A853"></path>
                                    <path d="M4.5 10.52a4.8 4.8 0 010-3.04V5.41H1.83a8 8 0 000 7.18l2.67-2.07z"
                                        fill="#FBBC05"></path>
                                    <path
                                        d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 001.83 5.4L4.5 7.49a4.77 4.77 0 014.48-3.3z"
                                        fill="#EA4335"></path>
                                </svg>

                                <!-- Sign in with Google -->
                            </a>
                            <a href="{% url 'social:begin' 'facebook' %}" class="btn btn-md btn-social btn-facebook bg-danger mx-1"
                                style="text-align:center;color: white;background: #3b5998;border-radius:50%;">
                                <!-- <span class="fa fa-facebook"></span> -->
                                <svg aria-hidden="true" class="svg-icon iconFacebook" width="20" height="20" style="font-size:1.2rem;position:relative;top:2px;"
                                    viewBox="0 0 18 18">
                                    <path
                                        d="M3 1a2 2 0 00-2 2v12c0 1.1.9 2 2 2h12a2 2 0 002-2V3a2 2 0 00-2-2H3zm6.55 16v-6.2H7.46V8.4h2.09V6.61c0-2.07 1.26-3.2 3.1-3.2.88 0 1.64.07 1.87.1v2.16h-1.29c-1 0-1.19.48-1.19 1.18V8.4h2.39l-.31 2.42h-2.08V17h-2.5z"
                                        fill="#ffffff"></path>
                                </svg>
                                <!-- Sign in with Facebook -->
                            </a>
                        </div>
                        <div class="d-flex flex-column mx-5">
                            <form id="loginform">
                                {% csrf_token %}
                                <div class="form-group my-4">
                                    {{ login_form.username|add_class:"form-control"|as_crispy_field }}
                                </div>
                                <div class="form-group my-4">
                                    {{ login_form.password|add_class:"form-control"|as_crispy_field }}
                                </div>
                                <div class="text-center my-4">
                                    <button onclick="custom_login()" type="button"
                                        class="btn btn-danger btn-round">Login</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <div class="signup-section">Not a member yet? <a href="#a" id="signup" class="text-danger"
                                data-toggle="modal" data-target="#signupModal"> Sign Up</a>.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- signup modal  -->
        <div class="modal fade" id="signupModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true" style="color: black;">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content bg-dark">
                    <div class="modal-header border-bottom-0">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-title text-center">
                            <h4>Register</h4>
                        </div>
                        <div class="d-flex flex-column mx-5">
                            <form method="POST" action="/accounts/register/">
                                {% csrf_token %}
                                <div class="form-group my-4">
                                    {{ registration_form.username|add_class:"form-control"|as_crispy_field }}
                                </div>
                                <div class="form-group my-4">
                                    {{ registration_form.email|add_class:"form-control"|as_crispy_field }}
                                </div>
                                <div class="form-group my-4">
                                    {{ registration_form.password1|add_class:"form-control"|as_crispy_field }}
                                </div>
                                <div class="form-group my-4">
                                    {{ registration_form.password2|add_class:"form-control"|as_crispy_field }}
                                </div>
                                <div class="text-center">
                                    <button type="submit" class="btn btn-danger btn-round">Register</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <div class="signup-section">Already a member? <a href="#a" id="login" class="text-danger"
                                data-toggle="modal" data-target="#loginModal">Login</a>.</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="back-wrapper">
            <div class="back-img-par">
                <div class="back-img-child">
                    <img src="{% static "/images/homico.png" %}" alt="">
                </div>
            </div>
        </div>
    </div>
    <p id="playing_video_id" hidden></p>
    <p id="playing_video_history_time" hidden></p>
    <p id="selected_comment_id" hidden></p>
    <div id="video_with_comments" style="display:none;">

    </div>
    <div id="selected_series">
        <p id="selected_series_id" hidden></p>
        <p id="selected_series_season_id" hidden></p>
        <div id="selected_season_description">

        </div>
        <div id="selected_season_freecontent">

        </div>
        <div id="selected_season_episodes">

        </div>
        <div id="selected_series_description">

        </div>
        <div id="selected_series_season">

        </div>
    </div>
    <div id="selected_movie">
        <p id="selected_movie_id" hidden></p>
        <div id="selected_movie_description">

        </div>
        <div id="selected_movie_freecontent">

        </div>
    </div>

    {% include "home/recommen.html" %}
    <!-- movie rating modal  -->
    <div class="modal fade" id="movierateCenter" tabindex="-1" role="dialog" aria-labelledby="rate-title"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title" id="movierate-title" style="color: white;">Rate</h5>
                    <button type="button" id="moviereset-rating" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body my-3 mx-3">
                    <div class="rating-taker">
                        <span class="px-3" style="color: white;">Rating</span>
                        <span class="px-1 movierating-val" value="1">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 movierating-val" value="2">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 movierating-val" value="3">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 movierating-val" value="4">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 movierating-val" value="5">
                            <i class="fas fa-star"></i>
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-sm" id="movierate-submit">Submit</button>
                </div>
            </div>
        </div>
    </div>
    <!-- series rating modal  -->
    <div class="modal fade" id="seriesrateCenter" tabindex="-1" role="dialog" aria-labelledby="rate-title"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title" id="seriesrate-title" style="color: white;">Rate</h5>
                    <button type="button" id="seriesreset-rating" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body my-3 mx-3">
                    <div class="rating-taker">
                        <span class="px-3" style="color: white;">Rating</span>
                        <span class="px-1 seriesrating-val" value="1">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 seriesrating-val" value="2">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 seriesrating-val" value="3">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 seriesrating-val" value="4">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="px-1 seriesrating-val" value="5">
                            <i class="fas fa-star"></i>
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-sm" id="seriesrate-submit">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- flag comment modal  -->
    <div class="modal fade" id="flagCommentCenter" tabindex="-1" role="dialog" aria-labelledby="flag-title"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title" id="flag-comment-title">Report Comment</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="radio" id="comment_flag_1" name="comment_flag" value="1">
                    <label for="comment_flag_1">Unwanted commercial content or spam</label><br>
                    <input type="radio" id="comment_flag_2" name="comment_flag" value="2">
                    <label for="comment_flag_2">Sexually explicit material</label><br>
                    <input type="radio" id="comment_flag_3" name="comment_flag" value="3">
                    <label for="comment_flag_3">Child abuse</label><br>
                    <input type="radio" id="comment_flag_4" name="comment_flag" value="4">
                    <label for="comment_flag_4">Hate speech or graphic violence</label><br>
                    <input type="radio" id="comment_flag_5" name="comment_flag" value="5">
                    <label for="comment_flag_5">Harassment or bullying</label><br>
                </div>
                <div class="modal-footer">
                    <button onclick="report_comment()" type="button" class="btn btn-danger btn-sm"
                        id="flag-submit">Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- flag video modal  -->
    <div class="modal fade" id="flagVideoCenter" tabindex="-1" role="dialog" aria-labelledby="flag-title"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bg-dark">
                <div class="modal-header">
                    <h5 class="modal-title" id="flag-video-title">Report Video</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="radio" id="video_flag_1" name="video_flag" value="1">
                    <label for="video_flag_1">Violent or repulsive content</label><br>
                    <input type="radio" id="video_flag_2" name="video_flag" value="2">
                    <label for="video_flag_2">Hateful or abusive content</label><br>
                    <input type="radio" id="video_flag_3" name="video_flag" value="3">
                    <label for="video_flag_3">Harmful or dangerous act</label><br>
                    <input type="radio" id="video_flag_4" name="video_flag" value="4">
                    <label for="video_flag_4">Sexual content</label><br>
                    <input type="radio" id="video_flag_5" name="video_flag" value="5">
                    <label for="video_flag_5">Child abuse</label><br>
                    <input type="radio" id="video_flag_6" name="video_flag" value="6">
                    <label for="video_flag_6">Promotes terrorism</label><br>
                    <input type="radio" id="video_flag_7" name="video_flag" value="7">
                    <label for="video_flag_7">Spam or misleading</label><br>
                    <input type="radio" id="video_flag_8" name="video_flag" value="8">
                    <label for="video_flag_8">Infringes my rights</label><br>
                    <input type="radio" id="video_flag_9" name="video_flag" value="9">
                    <label for="video_flag_9">Captions issue</label><br>
                </div>
                <div class="modal-footer">
                    <button onclick="report_video()" type="button" class="btn btn-danger btn-sm"
                        id="flag-submit">Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="{% static "/js/jquery-3.5.1.js" %}"></script>

    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous">
    </script>
    <!-- Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>
    <script src="{% static "/js/homes.js" %}"></script>
    <script src="{% static "/js/index.js" %}"></script>
    <!-- <script src="{% static "/js/videoplayer.js" %}"></script> -->


    <!-- to truncate the extra hash in url -->
    <script type="text/javascript">
        if (window.location.hash === "#_=_") {
            history.replaceState ?
                history.replaceState(null, null, window.location.href.split("#")[0]) :
                window.location.hash = "";
        }
    </script>

    <script>
        function custom_login() {

            var username = document.querySelector("#loginform #id_username").value;
            var password = document.querySelector("#loginform #id_password").value;

            // javascript data object
            var data = {
                'username': username,
                'password': password,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "account_login" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_username_exists != '') {
                        alert(data.is_username_exists);
                    } else if (data.is_password_matches != '') {
                        alert(data.is_password_matches);
                    } else if (data.is_successful != '') {
                        window.location.href = data.redirect_url;
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }

        // function to get search results
        function get_search_results() {
            var search_based_on = document.getElementById('sear').placeholder;
            var search_query = document.getElementById('sear').value;
            $('#search-results').empty();
            if (search_query != '') {
                // javascript data object
                var data = {
                    'search_based_on': search_based_on,
                    'search_query': search_query,
                }

                // adding data to javascript form which is to be send over ajax request
                var formData = new FormData();
                formData.append('data', JSON.stringify(data));

                $.ajax({
                    type: 'POST',
                    url: '{% url "get_search_results" %}',
                    data: formData,
                    dataType: 'json',
                    enctype: 'multipart/form-data',
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        // checking and handling error conditions
                        if (data.is_successful != '') {
                            var results = '';
                            if (Object.keys(data.search_results).length == 0) {
                                results = '<div class="dropdown-menu" aria-labelledby="sear"><div class="dropdown-item"><a href="#">No results found</a></div></div>';
                            }
                            else {
                                results = '<div class="dropdown-menu" aria-labelledby="sear">';
                                for (var key in data.search_results) {
                                    if (data.search_results[key][0] == 'M') {
                                        results += '<div class="dropdown-item"><a href="#" onclick="open_movie('+ data.search_results[key][1] +')">'+ data.search_results[key][2] +'</a></div>';
                                    }
                                    else {
                                        results += '<div class="dropdown-item"><a href="#" onclick="open_series('+ data.search_results[key][1] +')">'+ data.search_results[key][2] +'</a></div>';
                                    }
                                }
                                results += '</div>';
                            }
                            $('#search-results').append(results);
                        } else {
                            alert('Some unexpected error has occured. Try again.');
                        }
                    }
                });
            }
        }


        // function to get search results by category
        function search_results_by_subcategory(subcategory) {

            // javascript data object
            var data = {
                'subcategory': subcategory,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "search_results_by_subcategory" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_successful != '') {
                        $('#subcategory_search_results').empty();
                        set_content_display('none', 'none', 'none', 'none', 'none', 'none', 'none', 'none');

                        if (Object.keys(data.search_results).length == 0) {
                            alert('No data found for ' + subcategory);
                        }
                        else {
                            var results = '<div class="container-fluid my-5""><h4 class="font-weight-bold mx-5">Popular in '+ subcategory +'</h4><div id="search_results_subcategory-controls" class="carousel slide" data-ride="carousel" data-interval="false" data-wrap="false"><div class="carousel-inner"><div class="carousel-item active mx-5"><div class="row">';

                            var count = 0;
                            for (var val in data.search_results) {
                                count++;
                                if (count != 1 && (count-1)%6 == 0) {
                                    results += '<div class="carousel-item"><div class="row">';
                                }

                                results += '<div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2 spec-card"><div class="card py-3 px-3" style="border:0"><div class="card-body"><div class="ser-name-carouse text-center font-weight-bold">'+ data.search_results[val][1] +'</div><div class="img-seci">';

                                if (data.search_results[val][0] == 'M') {
                                    results += '<a href="#" onclick="open_movie('+ data.search_results[val][8] +')">';
                                }
                                else if (data.search_results[val][0] == 'S') {
                                    results += '<a href="#" onclick="open_series('+ data.search_results[val][8] +')">';
                                }

                                results += '<img class="img-fluid ser-img" src="'+ data.search_results[val][6] +'" alt="image4"></a></div></div></div></div>';

                                if (count%6 == 0) {
                                    results += '</div></div>';
                                }
                            }
                            if (Object.keys(data.search_results).length%6 != 0) {
                                results += '</div></div>';
                            }

                            results += '</div><a class="carousel-control-prev bg-danger" href="#search_results_subcategory-controls" role="button" data-slide="prev"style="display:none"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next bg-danger" href="#search_results_subcategory-controls" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div>';
                        }

                        $('#subcategory_search_results').append(results);
                        if ($('#search_results_subcategory-controls .carousel-inner .carousel-item:first').hasClass('active')) {
                            $('#search_results_subcategory-controls').children('#search_results_subcategory-controls .carousel-control-prev').hide();
                        }
                        if ($('#search_results_subcategory-controls .carousel-inner .carousel-item:last').hasClass('active')) {
                            $('#search_results_subcategory-controls').children('#search_results_subcategory-controls .carousel-control-next').hide();
                        }
                        bind_control_arrow_search_results_subcategory();
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // function that checks whether user is subscribed for a particular video or not
        function update_user_subscribed(video_id) {
            // javascript data object
            var data = {
                'video_id': video_id,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "check_user_subscription" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_subscribed == 'false') {
                        // console.log('not ok');
                        is_user_subscribed = false;
                    } else if (data.is_subscribed == 'true') {
                        console.log('ok');
                        is_user_subscribed = true;
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }

        function open_movie(movie_id) {
            // javascript data object
            var data = {
                'movie_id': movie_id
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "get_movie_details" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_movie_exists != '') {
                        alert(data.is_movie_exists);
                    } else if (data.is_successful != '') {
                        save_history_before_unloading();
                        $("#selected_movie_description").empty();
                        $("#selected_movie_freecontent").empty();

                        set_content_display('none', 'none', 'none', 'none', 'none', 'none', 'block',
                            'block');

                        document.getElementById('selected_movie_id').innerHTML = movie_id;

                        for (var key in data.movie_content_data) {
                            var htmlgen = '<div id="movie_' + movie_id +
                                '" class="series-view-section container-fluid"><div class="row lin-grade"><div class="col-xl-3 col-lg-5 col-md-5 col-sm-5 col-xs-5"><div class="info-sect mx-4">';

                            // javascript data object
                            var data1 = {
                                'video_id': data.movie_content_data[key][0],
                            }

                            // adding data to javascript form which is to be send over ajax request
                            var formData = new FormData();
                            formData.append('data', JSON.stringify(data1));

                            $.ajax({
                                type: 'POST',
                                url: '{% url "check_user_subscription" %}',
                                data: formData,
                                dataType: 'json',
                                enctype: 'multipart/form-data',
                                processData: false,
                                contentType: false,
                                success: function (data2) {

                                    // collecing movie movie data and sending it to the play movie and pay per view functions
                                    var video_name = `'${data.movie_content_data[key][1]}'`;
                                    var video_description =
                                        `'${data.movie_content_data[key][2]}'`;
                                    var video_category = `'${data.movie_content_data[key][4]}'`;
                                    var video_tags = new Array();
                                    var video_subcategory = new Array();
                                    var video_language =
                                        `'${data.movie_content_data[key][10]}'`;
                                    var video_cost = data.movie_content_data[key][11];
                                    var video_comments = new Array();

                                    for (var i = 0; i < data.movie_content_data[key][8]
                                        .length; i++) {
                                        video_tags.push(data.movie_content_data[key][8][i]);
                                    }
                                    var tags = video_tags.join("!@#$%^&*");
                                    tags = `'${tags}'`;

                                    for (var i = 0; i < data.movie_content_data[key][9]
                                        .length; i++) {
                                        video_subcategory.push(data.movie_content_data[key][9][
                                            i
                                        ]);
                                    }
                                    var subcategories = video_subcategory.join("!@#$%^&*");
                                    subcategories = `'${subcategories}'`;

                                    for (var i = 0; i < data.movie_content_data[key][12]
                                        .length; i++) {
                                        video_comments.push(data.movie_content_data[key][12][i][
                                            0
                                        ]);
                                        video_comments.push(data.movie_content_data[key][12][i][
                                            1
                                        ]);
                                        video_comments.push(data.movie_content_data[key][12][i][
                                            2
                                        ]);
                                    }
                                    var comments = video_comments.join("!@#$%^&*");
                                    comments = `'${comments}'`;

                                    // checking and handling error conditions
                                    if (data2.is_subscribed == 'false') {
                                        is_user_subscribed = false;
                                        if (!is_user_subscribed) {
                                            htmlgen +=
                                                '<div><div class="access-lock bg-danger text-center"><div class="py-1"><i class="fas fa-lock"></i></div></div><button onclick="pay_per_view(' +
                                                data.movie_content_data[key][0] + ',' +
                                                video_name + ',' + video_description + ',' +
                                                video_category + ',' + tags + ',' +
                                                subcategories + ',' + video_language + ',' +
                                                video_cost + ',' + comments + ',' + `'movie'` +
                                                ')" class="bg-danger" style="border: 0;">Pay Rs. ' +
                                                data.movie_content_data[key][11] +
                                                ' to unlock</button></div>';
                                        }
                                    } else if (data2.is_subscribed == 'true') {
                                        is_user_subscribed = true;

                                    } else {
                                        alert('Some unexpected error has occured. Try again.');
                                    }

                                    htmlgen +=
                                        '<div class="series-naam py-4"><h4 class="font-weight-bold">' +
                                        data.movie_content_data[key][1] +
                                        '</h4><div class="font-weight-bold"><p>';

                                    for (var i = 0; i < data.movie_content_data[key][9]
                                        .length; i++) {
                                        htmlgen += data.movie_content_data[key][9][i] + ' | ';
                                    }

                                    htmlgen += '</p><p>';

                                    for (var i = 0; i < data.movie_content_data[key][8]
                                        .length; i++) {
                                        htmlgen += data.movie_content_data[key][8][i] + ' | ';
                                    }

                                    htmlgen += '</p><p>' + data
                                        .movie_content_data[key][10] +
                                        '</p></div><div class="ser-describ">' + data
                                        .movie_content_data[key][2] +
                                        '</div></div></div><button type="button" onclick="play_movie(' +
                                        data.movie_content_data[key][0] + ',' + video_name +
                                        ',' + video_description + ',' + video_category + ',' +
                                        tags + ',' + subcategories + ',' + video_language +
                                        ',' + video_cost + ',' + comments +
                                        ')" class="vid-dislike mx-4 mr-auto" title="play"><span class="ico-cont bg-danger text-center py-1 px-2"><span class="py-3"><i class="fas fa-play"></i></span></span><p class="add-to-rate py-3">Play</p></button><button type="button" class="vid-dislike mx-2 mr-auto" title="Dislike" data-toggle="modal" data-target="#movierateCenter"><span class="ico-cont bg-danger text-center py-1 px-1"><span class="py-3"><i class="fas fa-star"></i></span></span><p class="add-to-rate py-3">Rate</p></button></div><div class="col-xl-9 col-lg-7 col-md-7 col-sm-7 col-xs-7"><div class="ser-tp-tmb"><img class="img-fluid ser-tmb-img" src="' +
                                        data.movie_content_data[key][3] +
                                        '"alt="image4"></div></div></div></div>';
                                    $("#selected_movie_description").append(htmlgen);
                                }
                            });

                            var freecontent = '<div><div id="movie_content_' + movie_id +
                                '" class="free-description-section"><div class="container-fluid my-5"><h3 class="font-weight-bold mx-5 px-4">Trailers and Clips<i class="arrow right mx-1"></i></h4><div id="movie_freecontent-controls" class="carousel slide" data-ride="carousel" data-interval="false" data-wrap="false"><div class="carousel-inner"><div class="carousel-item active mx-5"><div class="row">';

                            var count = 0;
                            for (var val in data.movie_free_data) {
                                count++;
                                if (count != 1 && (count - 1) % 6 == 0) {
                                    freecontent += '<div class="carousel-item"><div class="row">';
                                }

                                var video_name = `'${data.movie_free_data[val][1]}'`;
                                var video_description = `'${data.movie_free_data[val][2]}'`;
                                var video_category = `'${data.movie_free_data[val][4]}'`;
                                var video_tags = new Array();
                                var video_subcategory = new Array();
                                var video_language = `'${data.movie_free_data[val][10]}'`;
                                var video_cost = data.movie_free_data[val][11];
                                var video_comments = new Array();

                                for (var i = 0; i < data.movie_free_data[val][8].length; i++) {
                                    video_tags.push(data.movie_free_data[val][8][i]);
                                }
                                var tags = video_tags.join("!@#$%^&*");
                                tags = `'${tags}'`;

                                for (var i = 0; i < data.movie_free_data[val][9].length; i++) {
                                    video_subcategory.push(data.movie_free_data[val][9][i]);
                                }
                                var subcategories = video_subcategory.join("!@#$%^&*");
                                subcategories = `'${subcategories}'`;

                                for (var i = 0; i < data.movie_free_data[val][12].length; i++) {
                                    video_comments.push(data.movie_free_data[val][12][i][0]);
                                    video_comments.push(data.movie_free_data[val][12][i][1]);
                                    video_comments.push(data.movie_free_data[val][12][i][2]);
                                }
                                var comments = video_comments.join("!@#$%^&*");
                                comments = `'${comments}'`;

                                freecontent +=
                                    '<div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2 spec-card"><div class="card py-3 px-3" style="border:0"><div class="card-body"><div class="ser-name-carouse text-center font-weight-bold">' +
                                    data.movie_free_data[val][1] +
                                    '</div><div class="img-seci"><a href="#" onclick="play_free_movie(' +
                                    data.movie_free_data[val][0] + ',' + video_name + ',' +
                                    video_description + ',' + video_category + ',' + tags + ',' +
                                    subcategories + ',' + video_language + ',' + video_cost + ',' +
                                    comments + ')"><img class="img-fluid ser-img" src="' + data
                                    .movie_free_data[val][3] +
                                    '" alt="image4"></a></div></div></div></div>';

                                if (count % 6 == 0) {
                                    freecontent += '</div></div>';
                                }
                            }
                            if (Object.keys(data.movie_free_data).length % 6 != 0) {
                                freecontent += '</div></div>';
                            }
                            freecontent +=
                                '</div><a class="carousel-control-prev bg-danger" href="#movie_freecontent-controls" role="button" data-slide="prev"style="display:none"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next bg-danger" href="#movie_freecontent-controls" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div></div></div>';

                        }

                        $("#selected_movie_freecontent").append(freecontent);
                        if ($('#movie_freecontent-controls .carousel-inner .carousel-item:first').hasClass(
                                'active')) {
                            $('#movie_freecontent-controls').children(
                                '#movie_freecontent-controls .carousel-control-prev').hide();
                        }
                        if ($('#movie_freecontent-controls .carousel-inner .carousel-item:last').hasClass(
                                'active')) {
                            $('#movie_freecontent-controls').children(
                                '#movie_freecontent-controls .carousel-control-next').hide();
                        }
                        bind_control_arrow_movie_freecontent();

                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }




        // function to pay for pay_per_view video
        function get_pay_per_view_video(video_id, video_name, video_description, video_category, video_tags,
            video_subcategory, video_language, video_cost, video_comments, video_type) {
            // javascript data object
            var data = {
                'video_id': video_id,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "get_pay_per_view_video" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.insufficient_balance != '') {
                        alert(data.insufficient_balance);
                    } else if (data.is_successful != '') {

                        if (video_type == 'movie') {
                            play_movie(video_id, video_name, video_description, video_category, video_tags,
                                video_subcategory, video_language, video_cost, video_comments);
                        } else if (video_type == 'series') {
                            var lock_id = '#lock_' + video_id;
                            var pay_btn_id = '#pay_per_view_button_' + video_id;
                            $(lock_id).remove();
                            $(pay_btn_id).remove();
                            play_episode(video_id, video_name, video_description, video_category,
                                video_tags, video_subcategory, video_language, video_cost,
                                video_comments)
                        }
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }

        // function to check whether user has sufficient bal in his wallet to pay for pay per view service
        function pay_per_view(video_id, video_name, video_description, video_category, video_tags, video_subcategory,
            video_language, video_cost, video_comments, video_type) {
            // javascript data object
            var data = {
                'video_id': video_id
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "check_min_wallet_bal" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.insufficient_balance != '') {
                        alert(data.insufficient_balance);
                    } else if (data.is_successful != '') {
                        var r = confirm("Paying Rs. " + data.video_cost);
                        if (r == true) {
                            // user confimed payment for pay-per-view
                            get_pay_per_view_video(video_id, video_name, video_description, video_category,
                                video_tags, video_subcategory, video_language, video_cost,
                                video_comments, video_type);
                        } else {
                            // user cancelled payment for pay-per-view
                        }
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // function to get series details through ajax call
        function open_series(series_id) {
            // javascript data object
            var data = {
                'series_id': series_id
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "get_series_details" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_series_exists != '') {
                        alert(data.is_series_exists);
                    } else if (data.is_successful != '') {
                        save_history_before_unloading();
                        $("#selected_series_description").empty();
                        $("#selected_series_season").empty();

                        set_content_display('none', 'none', 'none', 'none', 'block', 'block', 'none',
                            'none');

                        document.getElementById('selected_series_id').innerHTML = series_id;
                        for (var key in data.series_content_data) {
                            var htmlgen = '<div id="series_' + key +
                                '" class="series-view-section container-fluid"><div class="row lin-grade"><div class="col-xl-3 col-lg-5 col-md-5 col-sm-5 col-xs-5"><div class="info-sect mx-4"><div class="series-naam py-4"><h4 class="font-weight-bold">' +
                                data.series_content_data[key][0] +
                                '</h4><div class="font-weight-bold"><p>' + data
                                .series_content_data[key][3] + ' | ';

                            for (var i = 0; i < data.series_content_data[key][5].length; i++) {
                                htmlgen += data.series_content_data[key][5][i] + ' | ';
                            }

                            htmlgen += '</p></div><div class="ser-describ">' + data.series_content_data[key]
                                [1] +
                                '</div></div></div><button type="button" class="vid-dislike mx-4" title="Dislike" data-toggle="modal" data-target="#seriesrateCenter"><span class="ico-cont bg-danger text-center py-1 px-1"><span class="py-3"><i class="fas fa-star"></i></span></span><p class="add-to-rate py-3">Rate</p></button></div><div class="col-xl-9 col-lg-7 col-md-7 col-sm-7 col-xs-7"><div class="ser-tp-tmb"><img class="img-fluid ser-tmb-img" src="' +
                                data.series_content_data[key][4] + '"alt="image4"></div></div></div></div>';
                            var seasons = '<div><div id="series_season_' + key +
                                '" class="free-description-section"><div class="container-fluid to-observe"><div class="pad-addr"><h3 class="font-weight-bold">Seasons<i class="arrow right mx-1"></i></h3><div class="pad-car-add"><div id="series_season-controls" class="carousel slide" data-ride="carousel" data-interval="false" data-wrap="false"><div class="carousel-inner"><div class="carousel-item active"><div class="row">';
                            var count = 0;
                            for (var val in data.series_season_data) {
                                count++;
                                if (count != 1 && (count - 1) % 6 == 0) {
                                    seasons += '<div class="carousel-item"><div class="row">';
                                }
                                seasons +=
                                    '<div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2 spec-card"><div class="card py-3 px-1" style="border:0"><div class="card-body"><div class="ser-name-carouse text-center font-weight-bold">Season ' +
                                    data.series_season_data[val][1] +
                                    '</div><div class="img-seci"><a href="#" onclick="open_season(' + val +
                                    ')"><img class="img-fluid ser-img" src="' + data.series_season_data[val]
                                    [5] + '" alt="image4"></a></div></div></div></div>';

                                if (count % 6 == 0) {
                                    seasons += '</div></div>';
                                }
                            }
                            if (Object.keys(data.series_season_data).length % 6 != 0) {
                                seasons += '</div></div>';
                            }
                            seasons +=
                                '</div><a class="carousel-control-prev bg-danger" href="#series_season-controls" role="button" data-slide="prev"style="display:none"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next bg-danger" href="#series_season-controls" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div></div></div></div></div>';

                        }
                        $("#selected_series_description").append(htmlgen);
                        $("#selected_series_season").append(seasons);

                        if ($('#series_season-controls .carousel-inner .carousel-item:first').hasClass(
                                'active')) {
                            $('#series_season-controls').children(
                                '#series_season-controls .carousel-control-prev').hide();
                        }
                        if ($('#series_season-controls .carousel-inner .carousel-item:last').hasClass(
                                'active')) {
                            $('#series_season-controls').children(
                                '#series_season-controls .carousel-control-next').hide();
                        }
                        bind_control_arrow_series_season();
                        callit();
                        oncallit();
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        function open_season(series_season_id) {
            // javascript data object
            var data = {
                'series_season_id': series_season_id
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "get_season_details" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_season_exists != '') {
                        alert(data.is_season_exists);
                    } else if (data.is_successful != '') {
                        save_history_before_unloading();
                        $("#selected_season_description").empty();
                        $("#selected_season_freecontent").empty();
                        $("#selected_season_episodes").empty();

                        document.getElementById('selected_series_season_id').innerHTML = series_season_id;

                        for (var key in data.season_content_data) {
                            var htmlgen = '<div id="series_season_' + key +
                                '" class="series-view-section container-fluid"><div class="row lin-grade"><div class="col-xl-3 col-lg-5 col-md-5 col-sm-5 col-xs-5"><div class="info-sect mx-4"><div class="series-naam py-4"><h4 class="font-weight-bold">Season ' +
                                data.season_content_data[key][0] +
                                '</h4><div class="font-weight-bold"><p>' + data
                                .season_content_data[key][3] + ' | ';

                            for (var i = 0; i < data.season_content_data[key][5].length; i++) {
                                htmlgen += data.season_content_data[key][5][i] + ' | ';
                            }

                            htmlgen += '</p></div><div class="ser-describ">' + data.season_content_data[key]
                                [1] +
                                '</div></div></div></div><div class="col-xl-9 col-lg-7 col-md-7 col-sm-7 col-xs-7"><div class="ser-tp-tmb"><img class="img-fluid ser-tmb-img" src="' +
                                data.season_content_data[key][4] + '"alt="image4"></div></div></div></div>';

                            var freecontent = '<div><div id="series_season_content_' + key +
                                '" class="free-description-section"><div class="container-fluid to-observe"><div class="pad-addr"><h3 class="font-weight-bold">Trailers and Clips<i class="arrow right mx-1"></i></h3><div class="pad-car-add"><div id="series_season_freecontent-controls" class="carousel slide" data-ride="carousel" data-interval="false" data-wrap="false"><div class="carousel-inner"><div class="carousel-item active"><div class="row">';

                            var count = 0;
                            for (var val in data.season_free_data) {
                                count++;
                                if (count != 1 && (count - 1) % 6 == 0) {
                                    freecontent += '<div class="carousel-item"><div class="row">';
                                }
                                var video_name = `'${data.season_free_data[val][1]}'`;
                                var video_description = `'${data.season_free_data[val][2]}'`;
                                var video_category = `'${data.season_free_data[val][10]}'`;
                                var video_tags = new Array();
                                var video_subcategory = new Array();
                                var video_language = `'${data.season_free_data[val][11]}'`;
                                var video_cost = data.season_free_data[val][9];
                                var video_comments = new Array();

                                for (var i = 0; i < data.season_free_data[val][8].length; i++) {
                                    video_tags.push(data.season_free_data[val][8][i]);
                                }
                                var tags = video_tags.join("!@#$%^&*");
                                tags = `'${tags}'`;

                                for (var i = 0; i < data.season_free_data[val][4].length; i++) {
                                    video_subcategory.push(data.season_free_data[val][4][i]);
                                }
                                var subcategories = video_subcategory.join("!@#$%^&*");
                                subcategories = `'${subcategories}'`;

                                for (var i = 0; i < data.season_free_data[val][12].length; i++) {
                                    video_comments.push(data.season_free_data[val][12][i][0]);
                                    video_comments.push(data.season_free_data[val][12][i][1]);
                                    video_comments.push(data.season_free_data[val][12][i][2]);
                                }
                                var comments = video_comments.join("!@#$%^&*");
                                comments = `'${comments}'`;

                                freecontent +=
                                    '<div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2 spec-card"><div class="card py-3 px-1" style="border:0"><div class="card-body"><div class="ser-name-carouse text-center font-weight-bold">' +
                                    data.season_free_data[val][1] +
                                    '</div><div class="img-seci"><a href="#" onclick="play_free_episode(' +
                                    data.season_free_data[val][0] + ',' + video_name + ',' +
                                    video_description + ',' + video_category + ',' + tags + ',' +
                                    subcategories + ',' + video_language + ',' + video_cost + ',' +
                                    comments + ')"><img class="img-fluid ser-img" src="' + data
                                    .season_free_data[val][3] +
                                    '" alt="image4"></a></div></div></div></div>';

                                if (count % 6 == 0) {
                                    freecontent += '</div></div>';
                                }
                            }
                            if (Object.keys(data.season_free_data).length % 6 != 0) {
                                freecontent += '</div></div>';
                            }
                            freecontent +=
                                '</div><a class="carousel-control-prev bg-danger" href="#series_season_freecontent-controls" role="button" data-slide="prev"style="display:none"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next bg-danger" href="#series_season_freecontent-controls" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div></div></div></div></div>';

                            var episodes = '<div><div id="series_episode_' + key +
                                '" class="free-description-section"><div class="container-fluid to-observe"><div class="pad-addr"><h3 class="font-weight-bold">Episodes<i class="arrow right mx-1"></i></h3><div class="pad-car-add"><div id="series_season_episodes-controls" class="carousel slide" data-ride="carousel" data-interval="false" data-wrap="false"><div class="carousel-inner"><div class="carousel-item active"><div class="row">';

                            count = 0;
                            for (var val in data.season_episodes) {
                                count++;
                                if (count != 1 && (count - 1) % 6 == 0) {
                                    episodes += '<div class="carousel-item"><div class="row">';
                                }

                                var video_name = `'${data.season_episodes[val][1]}'`;
                                var video_description = `'${data.season_episodes[val][2]}'`;
                                var video_category = `'${data.season_episodes[val][10]}'`;
                                var video_tags = new Array();
                                var video_subcategory = new Array();
                                var video_language = `'${data.season_episodes[val][11]}'`;
                                var video_cost = data.season_episodes[val][9];
                                var video_comments = new Array();

                                for (var i = 0; i < data.season_episodes[val][8].length; i++) {
                                    video_tags.push(data.season_episodes[val][8][i]);
                                }
                                var tags = video_tags.join("!@#$%^&*");
                                tags = `'${tags}'`;

                                for (var i = 0; i < data.season_episodes[val][4].length; i++) {
                                    video_subcategory.push(data.season_episodes[val][4][i]);
                                }
                                var subcategories = video_subcategory.join("!@#$%^&*");
                                subcategories = `'${subcategories}'`;

                                for (var i = 0; i < data.season_episodes[val][12].length; i++) {
                                    video_comments.push(data.season_episodes[val][12][i][0]);
                                    video_comments.push(data.season_episodes[val][12][i][1]);
                                    video_comments.push(data.season_episodes[val][12][i][2]);
                                }
                                var comments = video_comments.join("!@#$%^&*");
                                comments = `'${comments}'`;

                                episodes +=
                                    '<div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2 spec-card"><div class="card py-3 px-1" style="border:0"><div class="card-body"><div class="ser-name-carouse text-center font-weight-bold">Episode ' +
                                    val + ' - ' + data.season_episodes[val][1] +
                                    '</div><div class="img-seci"><a href="#" onclick="play_episode(' + data
                                    .season_episodes[val][0] + ',' + video_name + ',' + video_description +
                                    ',' + video_category + ',' + tags + ',' + subcategories + ',' +
                                    video_language + ',' + video_cost + ',' + comments + ')">';

                                if (data.season_episodes[val][13] == 0) {
                                    episodes += '<div id="lock_' + data.season_episodes[val][0] +
                                        '" class="access-lock-img bg-danger text-center"><div class="py-1 px-2"><i class="fas fa-lock"></i></div></div>';
                                }

                                episodes += '<img class="img-fluid ser-img" src="' + data.season_episodes[
                                    val][3] + '" alt="image4"></a>';

                                if (data.season_episodes[val][13] == 0) {
                                    episodes += '<div id="pay_per_view_button_' + data.season_episodes[val][
                                            0
                                        ] +
                                        '" class="card-view-button text-center"><button onclick="pay_per_view(' +
                                        data.season_episodes[val][0] + ',' + video_name + ',' +
                                        video_description + ',' + video_category + ',' + tags + ',' +
                                        subcategories + ',' + video_language + ',' + video_cost + ',' +
                                        comments + ',' + `'series'` +
                                        ')" type="submit" id="show-img-det" class="bg-danger" style="border: 0;border-radius: 2px;">Pay Rs. ' +
                                        data.season_episodes[val][9] + ' to unlock</a></div>';
                                }

                                episodes += '</div></div></div></div></div>';

                                if (count % 6 == 0) {
                                    episodes += '</div></div>';
                                }
                            }
                            if (Object.keys(data.season_episodes).length % 6 != 0) {
                                episodes += '</div></div>';
                            }
                            episodes +=
                                '</div><a class="carousel-control-prev bg-danger" href="#series_season_episodes-controls" role="button" data-slide="prev"style="display:none"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span></a><a class="carousel-control-next bg-danger" href="#series_season_episodes-controls" role="button" data-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span></a></div></div></div></div></div>';

                        }

                        $("#selected_season_description").append(htmlgen);
                        $("#selected_season_freecontent").append(freecontent);
                        $("#selected_season_episodes").append(episodes);

                        set_content_display('none', 'block', 'block', 'block', 'none', 'block', 'none',
                            'none');

                        if ($('#series_season_freecontent-controls .carousel-inner .carousel-item:first')
                            .hasClass('active')) {
                            $('#series_season_freecontent-controls').children(
                                '#series_season_freecontent-controls .carousel-control-prev').hide();
                        }
                        if ($('#series_season_freecontent-controls .carousel-inner .carousel-item:last')
                            .hasClass('active')) {
                            $('#series_season_freecontent-controls').children(
                                '#series_season_freecontent-controls .carousel-control-next').hide();
                        }
                        bind_control_arrow_series_season_freecontent();

                        if ($('#series_season_episodes-controls .carousel-inner .carousel-item:first')
                            .hasClass('active')) {
                            $('#series_season_episodes-controls').children(
                                '#series_season_episodes-controls .carousel-control-prev').hide();
                        }
                        if ($('#series_season_episodes-controls .carousel-inner .carousel-item:last')
                            .hasClass('active')) {
                            $('#series_season_episodes-controls').children(
                                '#series_season_episodes-controls .carousel-control-next').hide();
                        }
                        bind_control_arrow_series_season_episodes();
                        callit();
                        oncallit();
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }

        // HTML CODE FOR VIDEO PLAYER

        var playerhtml =
            '<!-- video running section  --><div class="runner-section container-fluid"><div class="row"><!-- video-player  --><div class="col-xl-9 col-lg-8 col-md-7 player-wrapper"><!-- if paid  --><div class="player" id="movie-video-player"><!-- video-head  --><div class="video-head"><div class="text-white"><h3 class="font-weight-bold">movie name</h4></div></div><!-- video-body  --><div class="video-body"><video class="player__video viewer" id="movie-video" preload="metadata"><source src="" id="movie-insert-vid" type="video/mp4"></video></div><!-- video-footer  --><div class="video-footer"><div class="player__controls" id="movie-plact"><!-- progress-bar  --><div class="progress"><div class="progress__filled"></div></div><!-- play/pause  --><button class="player__button toggle" data-toggle="tooltip" title="pause"><i id="movie-play-icon" class="fas fa-play"></i></button><!-- skip 10s backword --><button data-skip="-10" class="backword__button" data-toggle="tooltip" title="Skip -10s">10s</button><!-- skip 10s forward --><button data-skip="10" class="forward__button" data-toggle="tooltip" title="Skip 10s">10s</button><!-- volume  --><button class="volume__button" data-toggle="tooltip" title="mute" id="movie-volume"><i id="movie-vol-ico" class="fas fa-volume-up"></i></button><input type="range" name="volume" id="movie-vol-ran" class="player__slider" min="0" max="1" step="0.05" value="1"><!-- video timer  --><button id="movie-progressTime" class="timer__button"><span id="movie-current">00:00 / </span><span id="movie-duration">00:00</span></button><!-- playbackrate  --><!-- <input type="range" name="playbackRate" class="player__slider" min="0.5" max="2" step="0.1" value="1"> --><div class="fullscreen"><!-- setting  --><!-- <button id="movie-setting" class="setting__button" data-toggle="tooltip" title="setting"><span class="px-4"><i id="movie-setting-ico" class="fas fa-cog"></i></span></button> --><button type="button" class="prev-button mr-3"><i class="fas fa-step-backward"></i></button><button type="button" class="next-button"><i class="fas fa-step-forward"></i></button><div class="btn-group dropup"><button id="movie-setting" class="setting__button" data-toggle="dropdown" aria-haspopup="true"aria-expanded="false"><span class="px-4"><i id="movie-setting-ico" class="fas fa-cog"></i></span></button><div class="dropdown-menu plbcrt"><a href="#" class="dropdown-item playbacki dis">Playback speed</a><a href="#" class="dropdown-item playback">0.25</a><a href="#" class="dropdown-item playback">0.5</a><a href="#" class="dropdown-item playback">1</a><a href="#" class="dropdown-item playback">1.25</a><a href="#" class="dropdown-item playback">1.5</a><a href="#" class="dropdown-item playback">1.75</a><a href="#" class="dropdown-item playback">2</a></div></div><!-- picture-in-picture  --><button id="movie-pip" class="pip__button" data-toggle="tooltip" title="picture-in-picture"><span class="px-4"><i id="movie-pip-ico" class="fas fa-window-maximize"></i></span></button><!-- theatre view  --><button class="theatre__button" data-toggle="tooltip" title="theatre mode"><span class="px-4"><i id="movie-th-ico" class="fas fa-arrows-alt-v"></i></span></button><!-- fullscreen  --><button id="movie-fs" class="fs__button" data-toggle="tooltip" title="fullscreen"><span class="px-4"><i id="movie-fs-ico" class="fas fa-expand"></i></span></button></div></div></div></div></div><!-- sidebar content  --><div class="col-xl-3 col-lg-4 col-md-5 d-wt-th"><div class="card comment"><div class="card-header ser-hd"><h4 class="text-center">Comments</h4></div><div class="card-body"><ul id="movie-vid-comments"></ul><div class="position-absolute mx-2 my-2 bt-heig" style="bottom:0"><form class="form-inline row" role="form"><div class="form-group col-xl-8 col-lg-8 col-md-8"><textarea class="form-control" id="comment_section" rows="2" type="text" placeholder="Your comments"></textarea></div><div class="form-group col-xl-4 col-lg-4 col-md-4"><button class="btn btn-danger btn-sm mx-1" type="button" onclick="comment_on_video()">comment</button></div></form></div></div></div></div></div></div><div class="whole-sect"><div class="container-fluid"><div class="row"><div class="col-xl-9 col-lg-12 col-md-12"><!-- description flag section  --><div class="container-fluid descript-sect my-4"><div class="row py-3 px-3"><div class="col-xl-8 col-lg-8 col-md-8"><div class="vid-desc text-left pb-3"><div class="vid-hd py-1" id="video_description_1"></div><div class="vid-cat py-1" id="video_description_2"></div><div class="vid-des py-1" id="video_description_3"></div></div></div><div class="col-xl-4 col-lg-4 col-md-4 pb-3"><div class="flg-sect d-flex flex-row-reverse align-items-end"><button onclick="add_to_favourite()" type="button" class="add-to-fav mx-3" data-toggle="tooltip" data-placement="bottom" title="Add to favourites"><span class="ico-cont bg-danger text-center py-2 px-2"><span class="py-3"><i style="color: white;" class="fas fa-plus"></i></span></span><p class="add-to-fav-title py-3">Favourites</p></button><button type="button" class="vid-flag mx-3" data-toggle="modal" data-target="#flagVideoCenter"><span class="ico-cont bg-danger text-center py-2 px-2"><span class="py-3"><i style="color: white;" class="fas fa-flag"></i></span></span><p class="add-to-flag py-3">Report</p></button></div></div></div></div></div> <div class="col-xl-3 col-lg-12 col-md-12 d-on-th"></div> </div></div></div>';


        // function to handle truncated comment
        function show_comment(comment_id) {
            var text_id = "#show_comment_" + comment_id;
            var button_id = "#show_comment_button_" + comment_id;
            if ($(button_id).text().trim() == 'show') {
                $(text_id).css('display', 'block');
                $(button_id).text('hide');
            } else {
                $(text_id).css('display', '-webkit-box');
                $(button_id).text('show');
            }
        }

        // INCOMPLETE CODE FOR RESUME BUTTON --- RESUME BUTTON TO BE ADDED
        // function to resume video from where you have left it
        function resume_video(curr_time) {
            
        }


        //  setting up the video player
        function video_player_setup(video_id, video_name, video_description, video_category, video_tags, video_subcategory, video_language, video_cost, video_comments, video_watched) {

            $("#video_with_comments").empty();
            $("#video_with_comments").append(playerhtml);
            document.getElementById('video_description_1').innerHTML = video_name;

            var des = video_language + ' || ' + video_category + ' || ';
            var arr_subcat = video_subcategory.split("!@#$%^&*");
            var arr_tags = video_tags.split("!@#$%^&*");
            if (arr_subcat.length == 1 && arr_subcat[0] == '') {

            } else {
                for (var i = 0; i < arr_subcat.length; i++) {
                    des += arr_subcat[i] + ' ';
                }
                if (arr_subcat.length > 0) {
                    des += ' || ';
                }
            }
            if (arr_tags.length == 1 && arr_tags[0] == '') {

            } else {
                for (var i = 0; i < arr_tags.length; i++) {
                    des += arr_tags[i] + ' ';
                }
            }
            document.getElementById('video_description_2').innerHTML = des;
            document.getElementById('video_description_3').innerHTML = video_description;

            var arr_comments = video_comments.split("!@#$%^&*");
            var add_comm = '';
            for (var i = 0; i < arr_comments.length && arr_comments.length >= 3; i += 3) {
                add_comm +=
                    '<li><div class="row media"><!-- video-desccription  --><div class="col-xl-10 col-lg-10 col-md-10 col-sm-10"><div class="media-body px-1"><div style="display: inline;"><span class="font-weight-bold">' +
                    arr_comments[i] + '</span><button onclick="set_comment_id(' + arr_comments[i + 2] +
                    ')" type="button" class="flg-comm-button px-2" data-toggle="modal" data-target="#flagCommentCenter" style="float: right;background: #272B2C; border:0;"><i style="color: #d9534f;" class="fas fa-flag"></i></button></div><div class="d-cent text-justify" id="show_comment_' +
                    arr_comments[i + 2] + '">' + arr_comments[i + 1] +
                    '</div><button type="button" class="show-mr-button" id="show_comment_button_' + arr_comments[i +
                        2] + '" onclick="show_comment(' + arr_comments[i + 2] +
                    ')">show</button></div></div></div></li><br>';
            }
            $('#movie-vid-comments').append(add_comm);

            document.getElementById('playing_video_id').innerHTML = video_id;
            document.getElementById('playing_video_history_time').innerHTML = video_watched;
            initialize_movie_player();

            var video = document.querySelector('#movie-video');
            var video_url = window.location.origin + '/video/' + video_id;
            var playPromise = video.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                        // Automatic playback started!
                        // Show playing UI.
                    })
                    .catch(error => {
                        // Auto-play was prevented
                        // Show paused UI.
                    });
            }
            $('#movie-insert-vid').attr('src', video_url);
            $('.progress__filled').css('flex', '0');
        }

        // function to play movie video
        function play_movie(video_id, video_name, video_description, video_category, video_tags, video_subcategory,
            video_language, video_cost, video_comments) {

            // javascript data object
            var data = {
                'video_id': video_id,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "check_user_subscription" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_subscribed == 'false') {
                        alert('You have no active subscription pack. Buy a new one to enjoy streaming.');
                    } else if (data.is_subscribed == 'true') {

                        save_history_before_unloading();
                        set_content_display('block', 'none', 'none', 'none', 'none', 'none', 'none', 'block');
                        video_player_setup(video_id, video_name, video_description, video_category, video_tags, video_subcategory, video_language, video_cost, video_comments, data.video_watched);
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // function to play series episode
        function play_episode(video_id, video_name, video_description, video_category, video_tags, video_subcategory,
            video_language, video_cost, video_comments) {

            if (video_id == -1) {
                alert('This episode is currently unavailable.');
            } else {
                // javascript data object
                var data = {
                    'video_id': video_id,
                }

                // adding data to javascript form which is to be send over ajax request
                var formData = new FormData();
                formData.append('data', JSON.stringify(data));

                $.ajax({
                    type: 'POST',
                    url: '{% url "check_user_subscription" %}',
                    data: formData,
                    dataType: 'json',
                    enctype: 'multipart/form-data',
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        // checking and handling error conditions
                        if (data.is_video_exists != '') {
                            alert(data.is_video_exists);
                        } else if (data.is_subscribed == 'false') {
                            alert('You are not allowed to watch this episode. Either subscribe or pay for video.');
                        } else if (data.is_subscribed == 'true') {

                            save_history_before_unloading();
                            set_content_display('block', 'none', 'block', 'block', 'none', 'block', 'none', 'none');
                            video_player_setup(video_id, video_name, video_description, video_category, video_tags, video_subcategory, video_language, video_cost, video_comments, data.video_watched);
                            $('html, body').animate({
                                scrollTop: '0px'
                            }, 1000);
                        } else {
                            alert('Some unexpected error has occured. Try again.');
                        }
                    }
                });
            }
        }

        // function to play movie free video
        function play_free_movie(video_id, video_name, video_description, video_category, video_tags, video_subcategory,
            video_language, video_cost, video_comments) {

            save_history_before_unloading();
            set_content_display('block', 'none', 'none', 'none', 'none', 'none', 'none', 'block');
            video_player_setup(video_id, video_name, video_description, video_category, video_tags, video_subcategory, video_language, video_cost, video_comments, '');
        }

        // function to play series free video
        function play_free_episode(video_id, video_name, video_description, video_category, video_tags,
            video_subcategory, video_language, video_cost, video_comments) {

            save_history_before_unloading();
            set_content_display('block', 'none', 'block', 'block', 'none', 'block', 'none', 'none');
            video_player_setup(video_id, video_name, video_description, video_category, video_tags, video_subcategory, video_language, video_cost, video_comments, '');
        }


        var is_user_subscribed = false;
        // function to check whether user is subscribed or not
        window.setInterval(function () {

            var video_id = '';
            if (document.getElementById('video_with_comments').style.display == 'block') {
                video_id = document.getElementById('playing_video_id').innerHTML;
            }
            if (video_id != '') {
                // javascript data object
                var data = {
                    'video_id': video_id,
                }

                // adding data to javascript form which is to be send over ajax request
                var formData = new FormData();
                formData.append('data', JSON.stringify(data));

                $.ajax({
                    type: 'POST',
                    url: '{% url "check_user_subscription" %}',
                    data: formData,
                    dataType: 'json',
                    enctype: 'multipart/form-data',
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        // checking and handling error conditions
                        if (data.is_video_exists != '') {
                            alert(data.is_video_exists);
                        } else if (data.is_subscribed == 'false') {
                            if (is_user_subscribed == true) {
                                alert(
                                    'You are no longer subscribed. Buy a new plan to enjoy streaming!!'
                                )
                            }
                            is_user_subscribed = false;
                        } else if (data.is_subscribed == 'true') {
                            is_user_subscribed = true;
                        } else {
                            alert('Some unexpected error has occured. Try again.');
                        }
                    }
                });
            }
        }, 1000);


        // function to set comment id helps in knowing which comment user is referring to
        function set_comment_id(comment_id) {
            document.getElementById('selected_comment_id').innerHTML = comment_id;
        }


        // function to handle user report comment request
        function report_comment() {
            var comment_id = document.getElementById('selected_comment_id').innerHTML;
            var comment_flag_val = '';
            var ele = document.getElementsByName('comment_flag');

            for (var i = 0; i < ele.length; i++) {
                if (ele[i].checked) {
                    comment_flag_val = ele[i].value;
                }
            }

            // javascript data object
            var data = {
                'comment_id': comment_id,
                'comment_flag_val': comment_flag_val,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "report_comment" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_comment_exists != '') {
                        alert(data.is_comment_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        alert(data.is_successful);
                        $('#flagCommentCenter').modal('hide');
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // function to handle user report video request
        function report_video() {
            var video_id = document.getElementById('playing_video_id').innerHTML;
            var video_flag_val = '';
            var ele = document.getElementsByName('video_flag');

            for (var i = 0; i < ele.length; i++) {
                if (ele[i].checked) {
                    video_flag_val = ele[i].value;
                }
            }

            // javascript data object
            var data = {
                'video_id': video_id,
                'video_flag_val': video_flag_val,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "report_video" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        alert(data.is_successful);
                        $('#flagVideoCenter').modal('hide');
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // function to handle comment to video request
        function comment_on_video() {
            var video_id = document.getElementById('playing_video_id').innerHTML;
            var comment = document.getElementById('comment_section').value;

            // javascript data object
            var data = {
                'video_id': video_id,
                'comment': comment,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "add_video_comment" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        var add_comm =
                            '<li><div class="row media"><!-- video-desccription  --><div class="col-xl-10 col-lg-10 col-md-10 col-sm-10"><div class="media-body px-1"><div style="display: inline;"><span class="font-weight-bold">' +
                            data.username + '</span><button onclick="set_comment_id(' + data.comment_id +
                            ')" type="button" class="flg-comm-button px-2" data-toggle="modal" data-target="#flagCommentCenter" style="float: right;background: #272B2C; border:0;"><i style="color: #d9534f;" class="fas fa-flag"></i></button></div><div class="d-cent text-justify" id="show_comment_' +
                            data.comment_id + '">' + data.comment +
                            '</div><button type="button" class="show-mr-button" id="show_comment_button_' +
                            data.comment_id + '" onclick="show_comment(' + data.comment_id +
                            ')">show</button></div></div></div></li><br>';

                        $('#movie-vid-comments').append(add_comm);
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // function to handle user add video to favourites request
        function add_to_favourite() {
            var video_id = document.getElementById('playing_video_id').innerHTML;

            // javascript data object
            var data = {
                'video_id': video_id,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "add_to_favourite" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        alert(data.is_successful);
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        //got the rating ajax call to save it in the database
        $('#movierate-submit').on('click', function (e) {
            var movie_id = document.getElementById('selected_movie_id').innerHTML;

            // javascript data object
            var data = {
                'movie_id': movie_id,
                'movie_rating': movierating,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "rate_movie" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_movie_exists != '') {
                        alert(data.is_movie_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        $('#movierateCenter').modal('hide');
                        alert(data.is_successful);
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });

        })

        //got the rating ajax call to save it in the database
        $('#seriesrate-submit').on('click', function (e) {
            var series_id = document.getElementById('selected_series_id').innerHTML;

            // javascript data object
            var data = {
                'series_id': series_id,
                'series_rating': seriesrating,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "rate_series" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_series_exists != '') {
                        alert(data.is_series_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        $('#seriesrateCenter').modal('hide');
                        alert(data.is_successful);
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        })

        // function to add video last time watched history
        function save_video_history(video_id, curr_time) {
            // javascript data object
            var data = {
                'video_id': video_id,
                'curr_time':  curr_time,
            }

            // adding data to javascript form which is to be send over ajax request
            var formData = new FormData();
            formData.append('data', JSON.stringify(data));

            $.ajax({
                type: 'POST',
                url: '{% url "save_video_history" %}',
                data: formData,
                dataType: 'json',
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (data) {
                    // checking and handling error conditions
                    if (data.is_video_exists != '') {
                        alert(data.is_video_exists);
                    } else if (data.is_user_logged_in != '') {
                        alert(data.is_user_logged_in);
                    } else if (data.is_successful != '') {
                        // video history saved to database
                    } else {
                        alert('Some unexpected error has occured. Try again.');
                    }
                }
            });
        }


        // adding video history on closing window or tab or going to another link
        function save_history_before_unloading() {
            if (document.getElementById('video_with_comments').style.display == 'block') {
                // console.log('hit');
                var video_id = document.getElementById('playing_video_id').innerHTML;
                var video_player = document.querySelector('#movie-video');
                var curr_time = Math.floor(video_player.currentTime);
                save_video_history(video_id, curr_time);
            }
        }



        // for animation
        let options = {
            rootMargin: '0px 0px 0px 0px',
            threshold: 0.3
        }

        let callback = (entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animation = "sectionAnimate 1s forwards ease-in-out";
                    entry.target.classList.add('back-img-roo');
                    // unobserve
                    // observer.unobserve(entry.target);
                }
                else
                {
                    entry.target.className="container-fluid to-observe";
                }
            });
        };

        let observer = new IntersectionObserver(callback, options);

        function oncallit() {
            var sectionToObserve = document.querySelectorAll('.to-observe');
            // to obsereve the element
            sectionToObserve.forEach(element => {
                observer.observe(element);
            });
        }

        // lazy-loader
        let opt = {
            rootMargin: '0px 0px -300px 0px',
            threshold: 0
        }

        let callbac = (entries, observerImg) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    var src = entry.target.getAttribute('data-src');
                    entry.target.src = src;
                    // unobserve
                    observerImg.unobserve(entry.target);
                }
            });
        };

        let observerImg = new IntersectionObserver(callbac, opt);

        function callit() {
            var images = document.querySelectorAll('[data-src]');

            images.forEach(image => {
                observerImg.observe(image);
            })
        }

        // function should be called after observerImg has been created and after the element neede to be  observered has been loaded
        callit();
        oncallit();
    </script>
</body>

</html>